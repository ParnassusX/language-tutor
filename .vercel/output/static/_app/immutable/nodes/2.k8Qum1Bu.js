import"../chunks/CWj6FrbW.js";import{i as oe}from"../chunks/C5xkfXMJ.js";import{ac as ie,x as le,i as ne,ad as ve,ae as ce,M as de,N as R,T,X as l,a as x,O as ue,P as v,Q as c,af as b,ag as pe,R as d,_ as r}from"../chunks/L7fnnnqL.js";import{l as be,e as U,s as k}from"../chunks/ui5THt8X.js";import{i as L}from"../chunks/CAqSUsYy.js";function X(t,u,f){if(t.multiple){if(u==null)return;if(!ne(u))return ve();for(var s of t.options)s.selected=u.includes(S(s));return}for(s of t.options){var n=S(s);if(ce(n,u)){s.selected=!0;return}}(!f||u!==void 0)&&(t.selectedIndex=-1)}function fe(t){var u=new MutationObserver(()=>{X(t,t.__value)});u.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),le(()=>{u.disconnect()})}function _e(t,u,f=u){var s=!0;be(t,"change",n=>{var p=n?"[selected]":":checked",_;if(t.multiple)_=[].map.call(t.querySelectorAll(p),S);else{var h=t.querySelector(p)??t.querySelector("option:not([disabled])");_=h&&S(h)}f(_)}),ie(()=>{var n=u();if(X(t,n,s),s&&n===void 0){var p=t.querySelector(":checked");p!==null&&(n=S(p),f(n))}t.__value=n,s=!1}),fe(t)}function S(t){return"__value"in t?t.__value:t.value}var he=R('<button class="svelte-39rblt">Stop</button>'),ge=R('<button class="svelte-39rblt">Start Talking</button>'),me=R('<div class="loading svelte-39rblt"><div class="spinner svelte-39rblt"></div> <p class="svelte-39rblt"> </p></div>'),ye=R('<p class="error svelte-39rblt"> </p>'),we=R('<div class="transcripts svelte-39rblt"><div class="box svelte-39rblt"><h2 class="svelte-39rblt">You said (German):</h2> <p class="svelte-39rblt"> </p></div> <div class="box svelte-39rblt"><h2 class="svelte-39rblt">AI Response (English):</h2> <p class="svelte-39rblt"> </p></div> <div class="box svelte-39rblt"><h2 class="svelte-39rblt">Translation (German):</h2> <p class="svelte-39rblt"> </p></div> <div class="box svelte-39rblt"><h2 class="svelte-39rblt">Language Tip:</h2> <p class="svelte-39rblt"> </p></div></div>'),Te=R('<main class="svelte-39rblt"><h1 class="svelte-39rblt">Language Tutor</h1> <p class="svelte-39rblt">Press the button and start speaking in German.</p> <div class="container svelte-39rblt"><!> <button class="svelte-39rblt">Clear History</button> <div class="topic-selector svelte-39rblt"><label for="topic" class="svelte-39rblt">Select a Topic:</label> <select id="topic" class="svelte-39rblt"><option class="svelte-39rblt">General Conversation</option><option class="svelte-39rblt">Ordering at a Restaurant</option><option class="svelte-39rblt">Asking for Directions</option><option class="svelte-39rblt">At the Airport</option></select></div> <!> <!> <!></div></main>');function Ae(t,u){de(u,!1);let f=b(!1),s=b(!1),n=b(""),p=b(""),_=b(""),h=b("General Conversation"),B=b(!1),C=b(""),M=b(""),P=b(""),g=null;function Q(e){return new Promise((a,o)=>{const i=new FileReader;i.onloadend=()=>a(i.result),i.onerror=o,i.readAsDataURL(e)})}async function Y(){(await fetch("/api/transcribe",{method:"POST",headers:{"X-Action":"clear"}})).ok?(r(_,""),r(C,""),r(M,""),r(P,"")):console.error("Failed to clear history.")}async function z(){r(p,"");try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});g=new MediaRecorder(e);const a=[];g.ondataavailable=o=>{a.push(o.data)},g.onstop=async()=>{r(s,!0),r(n,"Transcribing audio...");try{const o=new Blob(a,{type:"audio/webm"}),i=await fetch("/api/transcribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio:await Q(o),topic:l(h)})});if(!i.ok){const O=await i.json();throw new Error(O.message||"Failed to transcribe audio.")}const m=await i.json();console.log("Server response:",m),r(B,!0),r(_,m.transcription),r(C,m.englishText),r(M,m.germanTranslation),r(P,m.languageTip),r(n,"Generating audio response...");const y=await fetch("/api/speak",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:l(C)})});if(!y.ok)throw new Error("Failed to fetch audio for the response.");const A=await y.blob(),F=URL.createObjectURL(A),w=new Audio(F);w.play(),w.onended=()=>{r(s,!1),r(n,"")}}catch(o){const i=o;console.error(i.message),r(p,i.message),r(s,!1),r(n,"")}},g.start(),console.log("MediaRecorder started"),r(f,!0)}catch(e){console.error("Error accessing microphone:",e),r(p,"Could not access the microphone. Please ensure you have given permission.")}}function K(){g&&g.state!=="inactive"&&(g.stop(),console.log("MediaRecorder stopped")),r(f,!1)}oe();var G=Te(),E=v(c(G),4),D=c(E);{var V=e=>{var a=he();U("click",a,K),x(e,a)},W=e=>{var a=ge();T(()=>a.disabled=l(s)),U("click",a,z),x(e,a)};L(D,e=>{l(f)?e(V):e(W,!1)})}var j=v(D,2),q=v(j,2),Z=v(c(q),2);T(()=>{l(h),pe(()=>{})}),d(q);var N=v(q,2);{var $=e=>{var a=me(),o=v(c(a),2),i=c(o,!0);d(o),d(a),T(()=>k(i,l(n))),x(e,a)};L(N,e=>{l(s)&&e($)})}var H=v(N,2);{var ee=e=>{var a=ye(),o=c(a,!0);d(a),T(()=>k(o,l(p))),x(e,a)};L(H,e=>{l(p)&&e(ee)})}var te=v(H,2);{var ae=e=>{var a=we(),o=c(a),i=v(c(o),2),m=c(i,!0);d(i),d(o);var y=v(o,2),A=v(c(y),2),F=c(A,!0);d(A),d(y);var w=v(y,2),O=v(c(w),2),re=c(O,!0);d(O),d(w);var I=v(w,2),J=v(c(I),2),se=c(J,!0);d(J),d(I),d(a),T(()=>{k(m,l(_)||"..."),k(F,l(C)||"..."),k(re,l(M)||"..."),k(se,l(P)||"...")}),x(e,a)};L(te,e=>{l(B)&&e(ae)})}d(E),d(G),T(()=>j.disabled=l(s)),U("click",j,Y),_e(Z,()=>l(h),e=>r(h,e)),x(t,G),ue()}export{Ae as component};
